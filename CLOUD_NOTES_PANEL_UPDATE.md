# 云端笔记面板更新说明

## 更新内容

将云端笔记面板从单账号切换模式改为多账号列表式展示。

## 主要变化

### 旧版本
- 使用 Radio 按钮在不同云盘类型之间切换
- 一次只能查看一个云盘的笔记
- 不支持同一类型的多个账号

### 新版本
- 使用折叠面板（Collapse）展示所有已连接的账号
- 可以同时展开多个账号查看笔记
- 每个账号独立显示，带有账号名称、云盘类型标签和笔记数量徽章
- 支持同一类型云盘的多个账号（例如：工作 OneDrive + 个人 OneDrive）

## 功能特性

### 1. 账号列表展示
- 每个已连接的账号显示为一个折叠面板
- 面板头部显示：
  - 云盘图标（带颜色区分）
  - 账号名称
  - 云盘类型标签（OneDrive / 百度网盘）
  - 笔记数量徽章

### 2. 懒加载
- 只有展开账号时才加载该账号的笔记列表
- 避免一次性加载所有账号的数据
- 提升性能和响应速度

### 3. 笔记操作
- 双击笔记打开/更新
- 鼠标悬停显示删除按钮
- 显示笔记状态：
  - "当前"标签：正在编辑的笔记
  - "云端有更新"标签：云端版本较新
  - 更新时间和文件大小

### 4. 刷新功能
- 点击刷新按钮刷新所有已展开账号的笔记列表
- 每个账号独立加载，互不影响

### 5. 空状态处理
- 没有连接账号时：提示用户去设置中添加账号
- 账号没有笔记时：显示"云端暂无笔记"

## UI 改进

1. **更清晰的层级结构**
   - 账号 → 笔记列表
   - 一目了然地看到所有账号和笔记

2. **更好的视觉反馈**
   - 加载状态：进度条
   - 悬停效果：边框颜色变化、阴影
   - 状态标签：颜色区分不同状态

3. **更灵活的交互**
   - 可以同时展开多个账号
   - 可以折叠不需要的账号
   - 独立刷新每个账号

## 技术实现

### 数据结构
```typescript
interface CloudNoteItem {
  id: string | number;
  name: string;
  updatedAt: number;
  size: number;
  path?: string;
  accountId: string;  // 新增：关联到账号
  provider: string;   // 新增：云盘类型
}
```

### 状态管理
- `accounts`: 所有已连接的账号列表
- `cloudNotesByAccount`: Map<accountId, notes[]> - 按账号组织的笔记
- `loadingAccounts`: Set<accountId> - 正在加载的账号
- `activeKeys`: 当前展开的账号 ID 列表

### API 调用
- 使用 `window.electronAPI.remoteAccounts.getAll()` 获取账号列表
- 根据账号的 provider 类型调用对应的 API：
  - OneDrive: `window.electronAPI.onedrive.*`
  - BaiduPan: `window.electronAPI.baidupan.*`

## 兼容性

- 完全兼容现有的下载、删除、状态判断逻辑
- 回调接口保持不变：`onNoteDownloaded`, `onNoteDeleted`
- 与 App.tsx 的集成无需修改

## 使用建议

1. 在设置中添加多个云盘账号
2. 打开云端笔记面板，查看所有账号的笔记
3. 展开需要的账号，双击笔记打开
4. 使用刷新按钮同步最新的云端笔记列表
