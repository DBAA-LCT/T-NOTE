# 修改日志

## [2.2.0] - 2024-02-09

### ✨ 新增功能

#### 编辑器体验优化
- 调整行间距从 1.5 到 1.3，显示更多内容
- 调整段落间距从 0.8em 到 0.5em，更紧凑的排版
- 图片支持 Shift + 拖拽调整大小
- 图片双击预览功能，支持滚轮缩放（0.1x - 5x）
- 预览窗口实时显示当前缩放比例
- 图片调整大小时显示蓝色边框提示

#### 文件关联和图标配置
- 支持双击.note文件直接打开笔记
- Windows系统自动关联.note文件到T-Note应用
- 支持为.note文件配置独立的文档图标
- 应用程序图标和文件图标可以不同，方便区分

#### 系统文件打开支持
- 添加 `open-file` 事件监听（macOS）
- 添加命令行参数处理（Windows/Linux）
- 双击.note文件自动加载文件内容
- 打开文件后自动展开页面列表

### 🔧 技术实现

#### 主进程（electron/main.ts）
- 添加 `open-file` 事件处理（macOS）
- 添加 `process.argv` 参数解析（Windows/Linux）
- 添加 `read-file` IPC 处理器
- 延迟发送文件路径确保窗口已加载

#### 预加载脚本（electron/preload.ts）
- 添加 `readFile` API
- 添加 `onOpenFileFromSystem` 事件监听器
- 支持移除事件监听器

#### 渲染进程（src/App.tsx）
- 添加系统文件打开事件监听
- 自动加载文件内容并更新状态
- 打开文件后展开页面列表

#### 打包配置（package.json）
- 配置 `fileAssociations` 关联.note文件
- 设置文件图标路径
- 设置文件描述和角色

### 📝 文档
- 添加 `图标配置说明.md`：详细的图标配置和使用指南
- 添加 `build-note-icon.html`：文档图标生成工具

### 🎨 图标系统
- 应用程序图标：`build/icon-256x256.png`
- 文件图标：`release/.icon-ico/icon.ico`（可自定义为note-icon.ico）
- 提供HTML工具生成文档风格的图标

### 📋 使用说明
1. 开发环境：需要打包后测试双击打开功能
2. 生产环境：安装后自动关联.note文件
3. 自定义图标：使用 `build-note-icon.html` 生成文档图标
4. 详细步骤：参考 `图标配置说明.md`

---

## [2.1.0] - 2024-02-09

### ✨ 新增功能

#### 窗口标题显示笔记名
- 窗口标题现在显示当前笔记名称
- 格式：`{笔记名} - T-Note`
- 未保存时显示星号：`{笔记名} - T-Note *`
- 没有笔记时显示：`T-Note`

#### 编辑器格式清除功能
- 按 ESC 键快速清除选中文本的格式
- 如果没有选中文本，清除当前光标位置的格式
- 清除后显示成功提示

#### 删除操作撤销功能（已替换为回收站）
- ~~删除页面后可以点击提示消息撤销删除~~
- ~~删除书签后可以点击提示消息撤销删除~~
- ~~删除待办后可以点击提示消息撤销删除~~
- ~~撤销提示持续 5 秒，点击即可恢复~~

#### 待办侧边栏分组功能
- 支持三种分组方式：按页面、按分类、按优先级
- 列表视图和分组视图可切换
- 分组视图使用折叠面板，可展开/收起
- 每个分组显示项目数量
- 分组图标和颜色区分

#### 标题栏折叠功能
- 点击"折叠"按钮可以折叠标题栏
- 折叠后只显示页面标题，节省空间
- 折叠状态下显示"展开"按钮
- 平滑的折叠/展开动画效果

#### 回收站功能
- 删除的页面、书签、待办会进入回收站
- 可以从回收站恢复已删除的项目
- 支持永久删除单个项目
- 支持一键清空回收站
- 显示删除时间和项目类型
- 回收站图标在侧边栏显示

#### 打开文件默认展开页面列表
- 打开笔记文件后，侧边栏自动展开页面列表
- 创建新笔记后，侧边栏自动展开页面列表
- 方便用户快速查看和管理页面

#### 内存优化
- 优化自动保存机制，减少定时器创建和销毁
- 限制最大Tab数量为5个，防止内存累积
- 优化事件监听器依赖项，减少不必要的重新绑定
- 添加性能监控代码（开发环境）
- 预期减少 30-50% 的内存占用

#### 编辑器体验优化
- 调整行间距从 1.8 到 1.5，提升内容显示密度
- 调整段落间距从 1em 到 0.8em，显示更多内容
- 图片支持 Shift + 拖拽调整大小
- 双击图片可以全屏预览
- 图片悬停时显示阴影效果
- 图片调整大小时显示蓝色边框提示

### 🔧 技术实现

#### 窗口标题
- 在 `electron/main.ts` 中添加 `set-window-title` IPC 处理
- 在 `electron/preload.ts` 中暴露 `setWindowTitle` API
- 在 `src/App.tsx` 中添加 useEffect 监听笔记名和保存状态变化
- 自动更新窗口标题

#### 格式清除
- 在 `src/components/Editor.tsx` 中添加键盘事件监听
- 使用 Quill 的 `removeFormat` 和 `format` API
- 支持清除选中文本和当前光标位置的格式

#### 待办分组
- 在 `src/components/TodoPanel.tsx` 中添加 `groupBy` 状态
- 实现按页面、分类、优先级的分组逻辑
- 动态生成分组标题、图标和颜色
- 使用 Ant Design 的 Collapse 组件展示分组

#### 标题栏折叠
- 在 `src/components/Editor.tsx` 中添加 `headerCollapsed` 状态
- 折叠状态下只显示标题文本
- 展开状态下显示完整的标题编辑和标签管理
- 使用 CSS transition 实现平滑动画

#### 回收站
- 在 `src/types.ts` 中添加 `DeletedItem` 和 `trash` 字段
- 创建 `src/components/TrashPanel.tsx` 组件
- 删除操作将项目移入回收站而非直接删除
- 支持恢复和永久删除操作
- 回收站数据随笔记一起保存

#### 打开文件默认展开页面列表
- 在 `src/App.tsx` 的 `openNote` 和 `createNewNote` 函数中添加 `setActiveTab('pages')`
- 打开或创建笔记后自动展开页面列表

#### 内存优化
- **优化自动保存机制**：使用 `useRef` 存储定时器，只依赖 `hasUnsavedChanges`
- **限制Tab数量**：最大5个Tab，超过时自动关闭最早的Tab
- **优化事件监听器**：减少 useEffect 依赖项，只依赖必要的 ID 和长度
- **性能监控**：添加开发环境下的内存使用监控（每30秒记录一次）
- 预期减少 30-50% 的内存占用

### 📝 文档
- 更新修改日志

---

## [2.0.0] - 2024-02-04

### 🎨 重大更新：UI 全面升级

#### ✨ 新增功能
- 集成 Ant Design 6.0 组件库
- 添加图标系统 (@ant-design/icons)
- 中文语言包配置
- 自定义主题配置（蓝色主题）
- 删除确认对话框
- 页面更新时间显示
- 友好的空状态提示
- 非阻塞式消息提示

#### 🎨 界面改进

**侧边栏**
- 使用 Ant Design Layout.Sider 组件
- 优化按钮布局和样式
- 添加图标辅助识别
- 卡片式页面列表
- 悬停效果和选中状态
- 显示页面更新时间
- 优化搜索框样式

**编辑器**
- 使用 Ant Design Layout.Content 组件
- 大号标题输入框
- 彩色标签系统
- 优化标签管理界面
- 改进富文本编辑器样式
- 友好的空状态提示

**整体布局**
- 统一的配色方案
- 优化间距和排版
- 改进滚动条样式
- 响应式设计

#### 🔧 技术改进
- 使用 Ant Design 组件替代原生 HTML
- 统一的设计系统
- 更好的 TypeScript 类型支持
- 优化的 CSS 样式
- 改进的代码结构

#### 🐛 修复
- 修复样式不一致问题
- 优化富文本编辑器显示
- 改进代码块样式

---

## [1.5.0] - Tab 栏和分屏功能

### ✨ 新增功能

#### 页面 Tab 栏
- 在编辑器顶部显示已打开页面的 Tab 栏
- 最多显示 5 个 Tab，超过 5 个会显示 "+N" 提示
- 点击 Tab 可以切换页面
- 每个 Tab 显示页面标题
- 当前激活的 Tab 会高亮显示（蓝色边框）
- Tab 可以关闭（点击 × 按钮）

#### 右键菜单
- 右键点击 Tab 显示上下文菜单
- 菜单选项：分屏显示、关闭

#### 分屏编辑
- 左右分屏显示两个页面
- 独立编辑，实时保存
- 关闭分屏按钮
- 延迟加载避免冲突（100ms）

#### Tab 拖拽手势
- **水平拖动排序**：在 Tab 栏内拖动 Tab 可以调整顺序
- **向右拖动分屏**：将 Tab 向右拖动超过 100px 后松开，自动分屏显示
- 被拖动的 Tab 变为半透明
- 目标位置显示蓝色左边框提示
- 拖动距离超过 100px 时，右侧显示蓝色提示框

#### Tab 拖放区域
- 在 Tab 栏右侧添加专门的分屏拖放区域
- 图标：双栏分屏图标
- 文字："拖到这里分屏"
- 拖动经过时高亮显示
- 轻微放大效果（scale: 1.05）

#### IDEA 风格双 Tab 栏
- 左右两侧各有独立的 Tab 栏
- Tab 只在对应侧显示，不会重复
- 拖拽 Tab 可以在两侧之间移动
- 自动全屏：一侧 Tab 全部关闭时，另一侧自动全屏

#### 焦点切换分屏
- 同一时间只有一个编辑器处于可编辑状态
- 点击任意一侧，该侧变为可编辑，另一侧自动变为只读预览
- 避免了 ReactQuill 多实例冲突
- 保持了双向编辑能力

#### 只读分屏方案
- 左侧：完整的可编辑 Editor 组件
- 右侧：轻量级的只读 ReadOnlyEditor 组件
- 完全避免 ReactQuill 多实例冲突
- 无延迟，即时显示
- 性能更好，资源占用更少

### 🔧 技术实现

#### 新增组件
- `PageTabs.tsx`：Tab 栏组件
- `PageTabs.css`：Tab 栏样式
- `ReadOnlyEditor.tsx`：只读编辑器组件
- `ReadOnlyEditor.css`：只读编辑器样式

#### 状态管理
- `openTabs`：已打开的 Tab 列表（页面 ID 数组）
- `leftTabs`：左侧 Tab 列表
- `rightTabs`：右侧 Tab 列表
- `activeLeftTab`：左侧激活的 Tab
- `activeRightTab`：右侧激活的 Tab
- `splitViewPageId`：分屏显示的页面 ID
- `activeSide`：当前激活的编辑器侧（'left' | 'right'）
- `draggedTab`：正在拖动的 Tab
- `isDraggingToSplit`：是否正在拖动到分屏区域

#### 主要函数
- `handleTabClick`：切换 Tab
- `handleTabClose`：关闭 Tab
- `handleSplitView`：切换分屏显示
- `handleSelectPage`：选择页面时自动添加到 Tab 栏
- `handleDragStart`：开始拖拽
- `handleDrag`：拖拽中
- `handleDrop`：放下

### 🐛 修复

#### 分屏功能错误修复
- 添加 splitPage 存在性检查
- 使用独特的 key 值（添加 "split-" 前缀）
- 简化 onUpdatePage 回调

#### 分屏功能白屏问题修复 V2
- 添加 stripHtml 错误处理
- 防止 Quill 格式重复注册
- 分屏延迟加载（100ms）
- 添加加载提示

### 📝 文档
- 添加 `TAB_FEATURE.md`：Tab 功能说明
- 添加 `TAB_USAGE.md`：Tab 使用指南
- 添加 `TAB_AND_SPLIT_SUMMARY.md`：Tab 栏和分屏功能完整说明
- 添加 `TAB_DRAG_GESTURES.md`：Tab 拖拽手势功能说明
- 添加 `TAB_DRAG_DROP_ZONE.md`：Tab 拖放区域功能说明
- 添加 `SPLIT_VIEW_FIX.md`：分屏功能错误修复说明
- 添加 `SPLIT_VIEW_FIX_V2.md`：分屏功能白屏问题修复 V2
- 添加 `READONLY_SPLIT_VIEW.md`：只读分屏方案说明
- 添加 `SPLIT_TAB_DESIGN.md`：分屏 Tab 设计说明
- 添加 `FOCUS_SWITCH_SPLIT.md`：焦点切换分屏功能说明
- 添加 `IDEA_STYLE_DUAL_TABS.md`：IDEA 风格双 Tab 栏系统
- 添加 `FINAL_DUAL_TAB_SYSTEM.md`：最终双 Tab 栏系统说明

---

## [1.4.0] - TODO 功能

### ✨ 新增功能

#### TODO 面板
- 添加待办事项管理功能
- 支持标题、描述、优先级、分类、截止日期
- 完成/取消完成功能
- 编辑和删除功能
- 按状态和优先级过滤
- 统计信息显示
- 优先级标识（高/中/低）
- 截止日期提醒
- 自动排序

#### 数据持久化
- TODO 数据保存在笔记文件中
- 与笔记一起自动保存
- 支持跨设备同步（通过笔记文件）

### 🔧 技术实现
- 新增 `TodoPanel.tsx` 组件
- 集成 dayjs 日期处理库
- 添加 TodoItem 数据结构

### 📝 文档
- 添加 `TODO功能说明.md`

---

## [1.3.0] - 书签功能

### ✨ 新增功能
- 在编辑器中添加书签标记
- 书签面板显示所有书签
- 点击书签快速定位到对应位置
- 书签高亮显示

---

## [1.2.0] - 搜索功能

### ✨ 新增功能
- 按标签搜索页面
- 实时过滤显示结果
- 搜索面板展示匹配的页面

---

## [1.1.0] - 图标栏

### ✨ 新增功能
- 添加左侧图标栏
- 页面列表图标
- 搜索图标
- 书签图标
- TODO 图标

---

## [1.0.0] - 初始版本

### ✨ 核心功能
- 富文本笔记编辑
- 多页面管理
- 标签系统
- 文件保存和打开
- 按标签搜索
- Ctrl+S 快捷键保存

### 🔧 技术栈
- React 18
- TypeScript 5
- Electron 28
- React Quill 2.0
- Vite 5

---

## 版本说明

### 版本号规则
遵循语义化版本 (Semantic Versioning)：
- 主版本号：重大更新，可能包含不兼容的改动
- 次版本号：新增功能，向后兼容
- 修订号：问题修复，向后兼容

### 更新类型
- ✨ 新增功能
- 🎨 界面改进
- 🔧 技术改进
- 🐛 问题修复
- 📝 文档更新
- ⚡ 性能优化
- 🔒 安全更新

---

## 未来计划

### v2.1.0（计划中）
- [ ] 添加暗色主题
- [ ] 支持笔记导出（PDF、Markdown）
- [ ] 添加快捷键面板
- [ ] 优化大文件加载性能
- [ ] 支持拖拽调整分屏比例
- [ ] 支持上下分屏
- [ ] 支持超过 5 个 Tab 的滚动
- [ ] 添加键盘快捷键切换编辑器

### v2.2.0（计划中）
- [ ] 笔记本分组功能
- [ ] 笔记加密功能
- [ ] 历史版本管理
- [ ] 附件上传功能
- [ ] 支持三栏、四栏布局
- [ ] 支持 Tab 组（Tab Groups）
- [ ] 支持固定 Tab（Pinned Tabs）

### v3.0.0（远期规划）
- [ ] 云同步功能
- [ ] 多设备协同
- [ ] 笔记分享功能
- [ ] 移动端支持

---

## 致谢

感谢以下开源项目：
- [Ant Design](https://ant.design/) - 企业级 UI 设计语言和 React 组件库
- [React](https://react.dev/) - 用于构建用户界面的 JavaScript 库
- [Electron](https://www.electronjs.org/) - 使用 Web 技术构建跨平台桌面应用
- [Quill](https://quilljs.com/) - 强大的富文本编辑器
- [Vite](https://vitejs.dev/) - 下一代前端构建工具
- [dayjs](https://day.js.org/) - 轻量级日期处理库
